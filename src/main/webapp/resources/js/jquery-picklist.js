!function(e){e.widget("awnry.pickList",{widgetEventPrefix:"pickList_",options:{mainClass:"pickList",listContainerClass:"pickList_listContainer",sourceListContainerClass:"pickList_sourceListContainer",controlsContainerClass:"pickList_controlsContainer",targetListContainerClass:"pickList_targetListContainer",listClass:"pickList_list",sourceListClass:"pickList_sourceList",targetListClass:"pickList_targetList",clearClass:"pickList_clear",listItemClass:"pickList_listItem",richListItemClass:"pickList_richListItem",selectedListItemClass:"pickList_selectedListItem",addAllClass:"pickList_addAll",addClass:"pickList_add",removeAllClass:"pickList_removeAll",removeClass:"pickList_remove",addAllLabel:"&gt;&gt;",addLabel:"&gt;",removeAllLabel:"&lt;&lt;",removeLabel:"&lt;",listLabelClass:"pickList_listLabel",sourceListLabel:"Available",sourceListLabelClass:"pickList_sourceListLabel",targetListLabel:"Selected",targetListLabelClass:"pickList_targetListLabel",sortItems:!0,sortAttribute:"label",listItemValueAttribute:"data-value",items:[]},_create:function(){var e=this;e._buildPickList(),e._refresh()},_buildPickList:function(){var t=this;t._trigger("beforeBuild"),t.pickList=e("<div/>").hide().addClass(t.options.mainClass).insertAfter(t.element).append(t._buildSourceList()).append(t._buildControls()).append(t._buildTargetList()).append(e("<div/>").addClass(t.options.clearClass)),t._populateLists(),t.element.hide(),t.pickList.show(),t._trigger("afterBuild")},_buildSourceList:function(){var t=this,s=e("<div/>").addClass(t.options.listContainerClass).addClass(t.options.sourceListContainerClass).css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).each(function(){this.onselectstart=function(){return!1}}),i=e("<div/>").text(t.options.sourceListLabel).addClass(t.options.listLabelClass).addClass(t.options.sourceListLabelClass);return t.sourceList=e("<ul/>").addClass(t.options.listClass).addClass(t.options.sourceListClass).delegate("li","click",{pickList:t},t._changeHandler),s.append(i).append(t.sourceList),t.sourceList.delegate(".pickList_listItem","dblclick",{pickList:t},function(e){var t=e.data.pickList;t._addItems(t.sourceList.children(".ui-selected"))}),s},_buildTargetList:function(){var t=this,s=e("<div/>").addClass(t.options.listContainerClass).addClass(t.options.targetListContainerClass).css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).each(function(){this.onselectstart=function(){return!1}}),i=e("<div/>").text(t.options.targetListLabel).addClass(t.options.listLabelClass).addClass(t.options.targetListLabelClass);return t.targetList=e("<ul/>").addClass(t.options.listClass).addClass(t.options.targetListClass).delegate("li","click",{pickList:t},t._changeHandler),s.append(i).append(t.targetList),t.targetList.delegate(".pickList_listItem","dblclick",{pickList:t},function(e){var t=e.data.pickList;t._removeItems(t.targetList.children(".ui-selected"))}),s},_buildControls:function(){var t=this;return t.controls=e("<div/>").addClass(t.options.controlsContainerClass),t.addAllButton=e("<button type='button' class='btn btn-primary'/> ").click({pickList:t},t._addAllHandler).html(t.options.addAllLabel).addClass(t.options.addAllClass),t.addButton=e("<button type='button' class='btn btn-primary'/>").click({pickList:t},t._addHandler).html(t.options.addLabel).addClass(t.options.addClass),t.removeButton=e("<button type='button' class='btn btn-xs btn-bricky'/>").click({pickList:t},t._removeHandler).html(t.options.removeLabel).addClass(t.options.removeClass),t.removeAllButton=e("<button type='button' class='btn btn-xs btn-bricky'/>").click({pickList:t},t._removeAllHandler).html(t.options.removeAllLabel).addClass(t.options.removeAllClass),t.controls.append(t.addAllButton).append(t.addButton).append(t.removeButton).append(t.removeAllButton),t.controls},_populateLists:function(){var e=this;e._trigger("beforePopulate");var t=[],s=[],i=e.element.children();i.not(":selected").each(function(){t.push(e._createDoppelganger(this))}),i.filter(":selected").each(function(){s.push(e._createDoppelganger(this))}),e.sourceList.append(t.join("\n")),e.targetList.append(s.join("\n")),e.insertItems(e.options.items),e._trigger("afterPopulate")},_addItems:function(t){var s=this;s._trigger("beforeAdd"),s.targetList.append(s._removeSelections(t));var i=[];t.each(function(){i.push(s._getItemValue(this))}),s.element.children().filter(function(){return-1!=e.inArray(this.value,i)}).attr("selected","selected"),s._refresh(),s._trigger("afterAdd",null,{items:t}),s._trigger("onChange",null,{type:"add",items:t})},_removeItems:function(t){var s=this;s._trigger("beforeRemove"),s.sourceList.append(s._removeSelections(t));var i=[];t.each(function(){i.push(s._getItemValue(this))}),s.element.children().filter(function(){return-1!=e.inArray(this.value,i)}).removeAttr("selected"),s._refresh(),s._trigger("afterRemove",null,{items:t}),s._trigger("onChange",null,{type:"remove",items:t})},_addAllHandler:function(e){var t=e.data.pickList;t._trigger("beforeAddAll");var s=t.sourceList.children();t.targetList.append(t._removeSelections(s)),t.element.children().not(":selected").attr("selected","selected"),t._refresh(),t._trigger("afterAddAll",null,{items:s}),t._trigger("onChange",null,{type:"addAll",items:s})},_addHandler:function(e){var t=e.data.pickList;t._addItems(t.sourceList.children(".ui-selected"))},_removeHandler:function(e){var t=e.data.pickList;t._removeItems(t.targetList.children(".ui-selected"))},_removeAllHandler:function(e){var t=e.data.pickList;t._trigger("beforeRemoveAll");var s=t.targetList.children();t.sourceList.append(t._removeSelections(s)),t.element.children().filter(":selected").removeAttr("selected"),t._refresh(),t._trigger("afterRemoveAll",null,{items:s}),t._trigger("onChange",null,{type:"removeAll",items:s})},_refresh:function(){var e=this;e._trigger("beforeRefresh"),e._refreshControls(),e.options.sortItems&&(e._sortItems(e.sourceList,e.options),e._sortItems(e.targetList,e.options)),e._trigger("afterRefresh")},_refreshControls:function(){var e=this;e._trigger("beforeRefreshControls"),e.sourceList.children().length?e.addAllButton.removeAttr("disabled"):e.addAllButton.attr("disabled","disabled"),e.targetList.children().length?e.removeAllButton.removeAttr("disabled"):e.removeAllButton.attr("disabled","disabled"),e.sourceList.children(".ui-selected").length?e.addButton.removeAttr("disabled"):e.addButton.attr("disabled","disabled"),e.targetList.children(".ui-selected").length?e.removeButton.removeAttr("disabled"):e.removeButton.attr("disabled","disabled"),e._trigger("afterRefreshControls")},_sortItems:function(t,s){var i=new Array;t.children().each(function(){i.push(e(this))}),i.sort(function(e,t){return e.attr(s.sortAttribute)>t.attr(s.sortAttribute)?1:e.attr(s.sortAttribute)==t.attr(s.sortAttribute)?0:-1}),t.empty();for(var l=0;l<i.length;l++)t.append(i[l])},_changeHandler:function(t){var s=t.data.pickList;if(t.ctrlKey)s._isSelected(e(this))?s._removeSelection(e(this)):(s.lastSelectedItem=e(this),s._addSelection(e(this)));else if(t.shiftKey){var i=s._getItemValue(this),l=s._getItemValue(s.lastSelectedItem);if(e(this).index()<e(s.lastSelectedItem).index()){var r=i;i=l,l=r}var a=!1,n=!0;s._clearSelections(e(this).parent()),e(this).parent().children().each(function(){s._getItemValue(this)==l&&(a=!0),a&&n&&s._addSelection(e(this)),s._getItemValue(this)==i&&(n=!1)})}else s.lastSelectedItem=e(this),s._clearSelections(e(this).parent()),s._addSelection(e(this));s._refreshControls()},_isSelected:function(e){return e.hasClass("ui-selected")},_addSelection:function(e){var t=this;return e.addClass("ui-selected").addClass("ui-state-highlight").addClass(t.options.selectedListItemClass)},_removeSelection:function(e){var t=this;return e.removeClass("ui-selected").removeClass("ui-state-highlight").removeClass(t.options.selectedListItemClass)},_removeSelections:function(t){var s=this;return t.each(function(){e(this).removeClass("ui-selected").removeClass("ui-state-highlight").removeClass(s.options.selectedListItemClass)}),t},_clearSelections:function(t){var s=this;t.children().each(function(){s._removeSelection(e(this))})},_setOption:function(t,s){switch(t){case"clear":}e.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){var t=this;t._trigger("onDestroy"),t.pickList.remove(),t.element.show(),e.Widget.prototype.destroy.call(t)},insert:function(e){var t=this,s=e.selected?t.targetList:t.sourceList,i=t._createSelectItem(e),l=t._createListItem(e);t.element.append(i),s.append(l),t._trigger("onChange"),t._refresh()},insertItems:function(t){var s=this,i=[],l=[],r=[];e(t).each(function(){var e=s._createSelectItem(this),t=s._createListItem(this);i.push(e),this.selected?r.push(t):l.push(t)}),s.element.append(i.join("\n")),s.sourceList.append(l.join("\n")),s.targetList.append(r.join("\n")),s._trigger("onChange"),s._refresh()},_createSelectItem:function(e){var t=e.selected?" selected='selected'":"";return"<option value='"+e.value+"'"+t+">"+e.label+"</option>"},_createListItem:function(e){var t=this;if(void 0!=e.element){var s=e.element.clone().wrap("<div>").parent().html();return e.element.hide(),"<li "+t.options.listItemValueAttribute+"='"+e.value+"' label='"+e.label+"' class='"+t.options.listItemClass+" "+t.options.richListItemClass+"'>"+s+"</li>"}return"<li "+t.options.listItemValueAttribute+"='"+e.value+"' label='"+e.label+"' class='"+t.options.listItemClass+"'>"+e.label+"</li>"},_createDoppelganger:function(t){var s=this;return"<li "+s.options.listItemValueAttribute+"='"+e(t).val()+"' label='"+e(t).text()+"' class='"+s.options.listItemClass+"'>"+e(t).text()+"</li>"},_getItemValue:function(t){var s=this;return e(t).attr(s.options.listItemValueAttribute)}})}(jQuery);