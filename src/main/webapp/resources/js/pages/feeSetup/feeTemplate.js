function IsNumeric(e){e.shiftKey?e.preventDefault():46==e.keyCode||8==e.keyCode||9==e.keyCode||37==e.keyCode||39==e.keyCode||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}function isAlphaNumeric(e){46==e.keyCode||8==e.keyCode||32==e.keyCode||9==e.keyCode||37==e.keyCode||39==e.keyCode||(e.shiftKey||(e.keyCode<65||e.keyCode>90)&&(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105))&&e.preventDefault()}function sessionList(){$.ajax({url:"sessionlist",type:"GET",success:function(e){var t=JSON.parse(e),a=Object.keys(t).length/2,l=document.getElementById("sessionSelect");$("#sessionSelect").find("option").remove();var n=document.createElement("option");n.value="select",n.innerHTML="Select",n.selected="selected",l.appendChild(n);for(var s=0;a>s;s++){sessionId="sessionId"+s,value="value"+s;var o=document.createElement("option");o.value=t[sessionId],o.innerHTML=t[value],l.appendChild(o)}},error:function(e){alert("Unable to get session!")}})}function facultyList(){$.ajax({url:"facultylist",type:"POST",success:function(e){var t=JSON.parse(e),a=Object.keys(t).length/2,l=document.getElementById("facultySelect");$("#facultySelect").find("option").remove();var n=document.createElement("option");n.value="select",n.innerHTML="Select",n.selected="selected",l.appendChild(n);for(var s=0;a>s;s++){facultyId="facultyid"+s,facultyName="facultyname"+s;var o=document.createElement("option");o.value=t[facultyId],o.innerHTML=t[facultyName],l.appendChild(o)}},error:function(e){alert("Unable to get faculty")}})}function facultyChange(e){semyear=document.getElementById("semOrYrSelect"),course=document.getElementById("courseSelect"),"select"==e?(course.options.length=0,opt=document.createElement("option"),opt.value="",opt.text="Select...",course.add(opt),semyear.options.length=0,opt1=document.createElement("option"),opt1.value="",opt1.text="Select...",semyear.add(opt1)):$.ajax({url:"/sgterp/protected/changeProvRegFaculty",type:"POST",data:"facultyId="+e,success:function(e){course.options.length=0,opt=document.createElement("option"),opt.value="",opt.text="Select...",course.add(opt),semyear.options.length=0,opt1=document.createElement("option"),opt1.value="",opt1.text="Select...";for(var t=0;t<e.length;t++)opt=document.createElement("option"),opt.value=e[t].courseId,opt.text=e[t].courseName,course.add(opt)},error:function(e){alert(JSON.stringify(e))}})}function courseChange(e){null==e||""==e?(semYear=document.getElementById("semOrYrSelect"),semYear.options.length=0,opt=document.createElement("option"),opt.value="",opt.text="Select...",semYear.add(opt)):$.ajax({url:"/sgterp/protected/courseChange",type:"POST",data:"courseId="+e,success:function(e){for(var t=0;t<e.length;t++)if(0==t);else{dataRecord3=e[t],semYear=document.getElementById("semOrYrSelect"),semYear.options.length=0,opt=document.createElement("option"),opt.value="",opt.text="Select...",semYear.add(opt);for(var a=0;a<dataRecord3.length;a++)opt=document.createElement("option"),opt.value=dataRecord3[a].coursePattern,opt.text=dataRecord3[a].coursePattern,semYear.add(opt)}faculty.selectmenu("refresh")},error:function(e){alert("error in save")}})}var specialKeys=new Array;specialKeys.push(8);var semesterStore,semesterSize,TableData=function(){var e=function(){var e=$("#sample_1").dataTable({aoColumnDefs:[{bSortable:!1,bSearchable:!1,aTargets:[-1,-2]}],oLanguage:{sLengthMenu:"Show _MENU_ Rows",sSearch:"",oPaginate:{sPrevious:"",sNext:""}},aaSorting:[[1,"asc"]],aLengthMenu:[[5,10,15,20,-1],[5,10,15,20,"All"]],iDisplayLength:10});$("#sample_1_wrapper .dataTables_filter input").addClass("form-control input-sm").attr("placeholder","Search"),$("#sample_1_wrapper .dataTables_length select").addClass("m-wrap small"),$("#sample_1_wrapper .dataTables_length select").select2(),$('#sample_1_column_toggler input[type="checkbox"]').change(function(){var t=parseInt($(this).attr("data-column")),a=e.fnSettings().aoColumns[t].bVisible;e.fnSetColumnVis(t,a?!1:!0)})},t=function(){function e(e,t){for(var a=e.fnGetData(t),l=$(">td",t),n=0,s=l.length;s>n;n++)e.fnUpdate(a[n],t,n,!1);e.fnDraw()}function t(e,t){var a=e.fnGetData(t),l=$(">td",t);facultyList(),sessionList(),l[0].innerHTML='<input type="text" class="form-size" maxlength="5" onkeydown="IsNumeric(event);" id="templateId" style="width:100%;" value="'+a[0]+'" required>',l[1].innerHTML='<input type="text" class="form-size" style="width:100%;" value="'+a[1]+'" required>',l[2].innerHTML='<select id="sessionSelect" class="form-control" ><option>Select</option></select>',l[3].innerHTML='<select id="facultySelect" class="form-control "  style="width:100%;" onchange="facultyChange(this.value);"><option>Select</option></select>',l[4].innerHTML='<select id="courseSelect" class="form-control " style="width:100%;" onchange="courseChange(this.value);"><option>Select</option></select>',l[5].innerHTML='<select id="semOrYrSelect" class="form-control  semOrYr"><option>Select</option></select>',l[6].innerHTML='<a class="save-row btn btn-green btn-sm" href=""><i class="fa fa-save"></i> Save</a>',l[7].innerHTML='<a class="cancel-row btn btn-bricky btn-sm" href=""><i class="clip-cancel-circle"></i> Cancel</a>',$("#sample_2").css("width","100%")}function a(e,t){var a=(e.fnGetData(t),t.cells),l=a[0].children[0].innerHTML,n=a[1].children[0].innerHTML,s=$(">td",t);sessionList(),facultyList(),s[0].innerHTML='<input type="text" readonly maxlength="5" onkeydown="IsNumeric(event);" class="form-size" value="'+l+'">',s[1].innerHTML='<input type="text" class="form-size" style="width:100%;" value="'+n+'">',s[2].innerHTML='<select id="sessionSelect" class="form-control" ><option>Select</option></select>',s[3].innerHTML='<select id="facultySelect" class="form-control" style="width:100%;"  onchange="facultyChange(this.value);"><option>Select</option></select>',s[4].innerHTML='<select id="courseSelect" class="form-control " style="width:100%;" onchange="courseChange(this.value);"><option>Select</option></select>',s[5].innerHTML='<select id="semOrYrSelect" class="form-control semOrYr" ><option>Select</option></select>',s[6].innerHTML='<a class="save-row btn btn-green btn-sm" href=""><i class="fa fa-save"></i> Save</a>',s[7].innerHTML='<a class="cancel-row btn btn-bricky btn-sm" href=""><i class="clip-cancel-circle"></i> Cancel</a>',$("#sample_2").css("width","100%")}function l(e,t){var a=$("input",t),l=$("select",t);if(null==a[0].value||""==a[0].value)return alert("Please Enter Template Id!"),!1;if(null==a[1].value||""==a[1].value)return alert("Please Enter Template Name!"),!1;if(null==l[0].value||""==l[0].value||"select"==l[0].value)return alert("Please select Session!"),!1;if(null==l[1].value||""==l[1].value||"select"==l[1].value)return alert("Please select faculty!"),!1;if(null==l[2].value||""==l[2].value||"select"==l[2].value)return alert("Please select course!"),!1;if(null==l[3].value||""==l[3].value||"select"==l[3].value)return alert("Please select sem/year!"),!1;if(0==warnBeforeUpdate("sample_2",a[0].value,0,"a","Template Id"))return!1;if(0==warnBeforeUpdate("sample_2",a[1].value,1,"a","Template Name"))return!1;var o=a[1].value,r=o.replace(/&/g,"%26");null!=a[0].value&&""!=a[0].value?$.ajax({url:"addFeeTemplate",type:"POST",data:"templateId="+a[0].value+"&templateName="+r+"&faculty.facultyId="+l[1].value+"&course.courseId="+l[2].value+"&session.sessionId="+l[0].value+"&semYr="+l[3].value,success:function(o){"duplicate record"==o?alert("Fee template already exists for these Details!"):"success"==o&&(e.fnUpdate('<a href="feeTemplateHead?templateId='+a[0].value+"&amp;templateName="+a[1].value+'">'+a[0].value+"</a>",t,0,!1),e.fnUpdate('<a href="feeTemplateHead?templateId='+a[0].value+"&amp;templateName="+a[1].value+'">'+a[1].value+"</a>",t,1,!1),e.fnUpdate(l[0].options[l[0].selectedIndex].text,t,2,!1),e.fnUpdate(l[1].options[l[1].selectedIndex].text,t,3,!1),e.fnUpdate(l[2].options[l[2].selectedIndex].text,t,4,!1),e.fnUpdate(l[3].options[l[3].selectedIndex].text,t,5,!1),e.fnUpdate('<a class="edit-row btn btn-green btn-sm" href=""><i class="fa fa-edit"> </i> Edit</a>',t,6,!1),e.fnUpdate('<a class="delete-row btn btn-bricky btn-sm" href=""><i class="fa fa-trash-o"></i> Delete</a>',t,7,!1),e.fnDraw(),n=!1,s=null,location.reload())},error:function(e){alert("Unable to save, Please try again!")}}):alert("Invalid Inputs")}var n=!1,s=null;$.ajax({url:"feeTemplatesList",type:"GET",success:function(t){store=JSON.parse(t),size=Object.keys(store).length/9;for(var a=0;a<size;a++)if(templateId="templateId"+a,templateName="templateName"+a,course="courseId"+a,faculty="facultyId"+a,semOrYr="semOrYr"+a,session="sessionId"+a,facultyName="facultyName"+a,courseName="courseName"+a,sessionValue="sessionValue"+a,0==n){s&&e(o,s),n=!0;var l;l=o.fnAddData(authCheck?["","","","","",""]:["","","","","","","",""]);var r=o.fnGetNodes(l[0]);o.fnUpdate('<a href="feeTemplateHead?templateId='+store[templateId]+"&amp;templateName="+store[templateName]+'">'+store[templateId]+"</a>",r,0,!1),o.fnUpdate('<a href="feeTemplateHead?templateId='+store[templateId]+"&amp;templateName="+store[templateName]+'">'+store[templateName]+"</a>",r,1,!1),o.fnUpdate(store[sessionValue],r,2,!1),o.fnUpdate(store[facultyName],r,3,!1),o.fnUpdate(store[courseName],r,4,!1),o.fnUpdate(store[semOrYr],r,5,!1),authCheck||(o.fnUpdate('<a class="edit-row btn btn-green btn-sm" href=""><i class="fa fa-edit"> </i> Edit</a>',r,6,!1),o.fnUpdate('<a class="delete-row btn btn-bricky btn-sm" href=""><i class="fa fa-trash-o"></i> Delete</a>',r,7,!1)),o.fnDraw(),n=!1,s=null}},error:function(e){alert("Unable to fetch data, Please try again!")}}),$("body").on("click",".add-row",function(a){if(a.preventDefault(),0==n){s&&e(o,s),n=!0;var l=o.fnAddData(["","","","","","","",""]),r=o.fnGetNodes(l[0]);t(o,r),s=r}}),$("#sample_2").on("click",".cancel-row",function(t){if(t.preventDefault(),n){n=!1,s=null;var a=$(this).parents("tr")[0];o.fnDeleteRow(a)}else e(o,s),s=null}),$("#sample_2").on("click",".delete-row",function(e){e.preventDefault(),n&&s&&(o.fnDeleteRow(s),n=!1);var t=$(this).parents("tr")[0],a=t.cells,l=a[0].children[0].innerHTML;bootbox.confirm("Are you sure to delete this template?",function(e){e&&($.blockUI({message:'<i class="fa fa-spinner fa-spin"></i> Do some ajax to sync with backend...'}),$.mockjax({url:"/tabledata/delete/webservice",dataType:"json",responseTime:1e3,responseText:{say:"ok"}}),$.ajax({url:"/tabledata/delete/webservice",dataType:"json",success:function(e){$.unblockUI(),"ok"==e.say&&$.ajax({url:"/tabledata/delete/webservice",dataType:"json",success:function(e){$.unblockUI(),"ok"==e.say&&$.ajax({url:"deleteFeeTemplate",type:"POST",data:"templateId="+l,success:function(e){o.fnDeleteRow(t),location.reload()},error:function(e){alert("Already in use")}})}})}}))})}),$("#sample_2").on("click",".save-row",function(e){e.preventDefault();var t=$(this).parents("tr")[0];$.blockUI({message:'<i class="fa fa-spinner fa-spin"></i> saving data...'}),$.mockjax({url:"/tabledata/add/webservice",dataType:"json",responseTime:1e3,responseText:{say:"ok"}}),$.ajax({url:"/tabledata/add/webservice",dataType:"json",success:function(e){$.unblockUI(),"ok"==e.say&&l(o,t)}})}),$("#sample_2").on("click",".edit-row",function(t){t.preventDefault(),s&&(n?(o.fnDeleteRow(s),n=!1):e(o,s));var l=$(this).parents("tr")[0];a(o,l),s=l});var o=$("#sample_2").dataTable({aoColumnDefs:[{bSortable:!1,bSearchable:!1,aTargets:[-1,-2]}],oLanguage:{sLengthMenu:"Show _MENU_ Rows",sSearch:"",oPaginate:{sPrevious:"",sNext:""}},aaSorting:[[1,"asc"]],aLengthMenu:[[5,10,15,20,-1],[5,10,15,20,"All"]],iDisplayLength:10});$("#sample_2_wrapper .dataTables_filter input").addClass("form-control input-sm").attr("placeholder","Search"),$("#sample_2_wrapper .dataTables_length select").addClass("m-wrap small"),$("#sample_2_wrapper .dataTables_length select").select2(),$('#sample_2_column_toggler input[type="checkbox"]').change(function(){var e=parseInt($(this).attr("data-column")),t=o.fnSettings().aoColumns[e].bVisible;o.fnSetColumnVis(e,t?!1:!0)})};return{init:function(){e(),t()}}}();