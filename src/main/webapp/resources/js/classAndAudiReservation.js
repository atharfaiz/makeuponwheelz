function changeEventDragEtc(e){for(i=0;i<reserveRoomListData.length;i++)if(reserveRoomListData[i].reservationId==e&&"Approved"==reserveRoomListData[i].status)return"false"}function currentuserLoginCheck(e){for(i=0;i<reserveRoomListData.length;i++)if(reserveRoomListData[i].reservationId==e&&reserveRoomListData[i].createdBy!=currentUserLogin)return writePermission||adminPermission?"true":"false"}function calculateDatetime(e,t,a,r){var n=6e4;e=24*e*60*60*1e3;var i=new Date(a.getTime()+t*n+e),l=new Date(r.getTime()+t*n+e);return i<(new Date).getTime()||l<(new Date).getTime()?(alert("Selected Date or Time is past!"),"false"):void 0}function eventL(){window.eventList=[],$("#calendar").fullCalendar("removeEvents"),"select"!=$("#roomSelect").val()&&$.ajax({url:"/sgterp/protected/reservedRoomList?buildingRoomId="+$("#roomSelect").val(),type:"POST",success:function(e){for(reserveRoomListData=e,i=0;i<e.length;i++)switch(titl=e[i].reason+"["+e[i].reservationId+"]",startDateTime=new Date(e[i].startDateTime),endDateTime=new Date(e[i].endDateTime),e[i].status){case"Pending":window.eventList[eventList.length]={title:titl,start:startDateTime,end:endDateTime,className:"label-blue",allDay:!1};break;case"Approved":window.eventList[eventList.length]={title:titl,start:startDateTime,end:endDateTime,className:"label-green",allDay:!1}}$("#calendar").fullCalendar("addEventSource",eventList)},error:function(e){alert("Internal server problem!")}})}var eventList=[],reserveRoomListData,Calendar=function(){var e=function(){var e=$("#event-management");$("#event-categories div.event-category").each(function(){var e={title:$.trim($(this).text())};$(this).data("eventObject",e),$(this).draggable({zIndex:999,revert:!0,revertDuration:50})});var t=new Date,a=(t.getDate(),t.getMonth(),t.getFullYear(),""),r=$("#calendar").fullCalendar({buttonText:{prev:'<i class="fa fa-chevron-left"></i>',next:'<i class="fa fa-chevron-right"></i>'},header:{left:"prev next today",center:"title",right:""},events:eventList,editable:!0,droppable:!0,drop:function(e,t){var a=$(this).data("eventObject"),r=$(this).attr("data-class"),n=$.extend({},a);n.start=e,n.allDay=t,r&&(n.className=[r]),$("#calendar").fullCalendar("renderEvent",n,!0),$("#drop-remove").is(":checked")&&$(this).remove()},selectable:!0,selectHelper:!0,select:function(t,n,l){if("select"==$("#buildingSelect").val())return alert("Please Select Value First"),void $("#calendar").fullCalendar("removeEvents");if("select"==$("#roomSelect").val())return alert("Please Select Value First"),void $("#calendar").fullCalendar("removeEvents");if(t<new Date||n<new Date)return void alert("Selected Date or Time is past!");for(i=0;i<reserveRoomListData.length;i++){var s=new Date(reserveRoomListData[i].startDateTime),o=new Date(reserveRoomListData[i].endDateTime);if(t>s&&o>t||n>s&&o>n)return alert("Room/Auditorium is already reserved/requested for this period!"),void eventL()}e.modal({backdrop:"static"}),a=$("<form></form>"),a.append("<div class='row'></div>"),a.find(".row").append("<div class='form-group'><label class='col-sm-4 control-label'>Reason</label><div class='col-sm-6'><input type='text' class='form-control input-sm'  id='reason' name='reason' required/></div></div>"),e.find(".remove-event").hide().end().find(".save-event").show().end().find(".modal-body").empty().prepend(a).end().find(".save-event").unbind("click").click(function(){$.ajax({url:"/sgterp/protected/addClassAndAudiReservation",type:"POST",data:"roomId="+$("#roomSelect").val()+"&reason="+$("#reason").val()+"&startTime="+t+"&endTime="+n,success:function(e){eventL()},error:function(e){alert("Internal server problem!")}}),e.modal("hide")}),e.find("form").on("submit",function(){return title=a.find("input[name='title']").val(),$categoryClass=a.find("select[name='category'] option:checked").val(),null!==title&&r.fullCalendar("renderEvent",{title:title,start:t,end:n,allDay:l,className:$categoryClass},!0),e.modal("hide"),!1}),r.fullCalendar("unselect")},eventClick:function(t,a,n){for(var i=t.title.indexOf("[")+1,l="";i<t.title.indexOf("]");)l+=t.title[i],i++;if("false"!=changeEventDragEtc(l)&&"false"!=currentuserLoginCheck(l)){var s=$("<form></form>");s.append("<label>Reason</label>"),s.append("<div class='input-group'><input type='text' class='form-control input-sm' value='"+t.title.split("[")[0]+"' id='reason' name='reason' required/><span class='input-group-btn'><button type='submit' class='btn btn-success'><i class='fa fa-check'></i> Save</button></span></div>"),e.modal({backdrop:"static"}),e.find(".remove-event").show().end().find(".save-event").hide().end().find(".modal-body").empty().prepend(s).end().find(".remove-event").unbind("click").click(function(){$.ajax({url:"/sgterp/protected/deleteClassAndAudiReservation",type:"POST",data:"reservationId="+l,success:function(e){r.fullCalendar("removeEvents",function(e){return e._id==t._id})},error:function(e){alert("Internal server problem!")}}),e.modal("hide")}),e.find("form").on("submit",function(){for(var a=t.title.indexOf("[")+1,r="";a<t.title.indexOf("]");)r+=t.title[a],a++;return $.ajax({url:"/sgterp/protected/addClassAndAudiReservation",type:"POST",data:"reservationId="+r+"&reason="+$("#reason").val(),success:function(e){eventL()},error:function(e){alert("Internal server problem!")}}),e.modal("hide"),!1})}}})};return{init:function(){e()}}}();